<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>分词</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->

</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <p class="cws-brand"><b>在线分词平台</b></p>
        </div>
    </div>
</nav>
<div class="main-container">
    <el-input
            type="textarea"
            :autosize="{ minRows: 3 }"
            placeholder="请输入内容"
            v-model="input_text">
    </el-input>
    <!--<div class="input-container">-->
    <!--<textarea class="form-control" v-model="input_text" rows="3"></textarea>-->
    <!--</div>-->
    <div class="button-container">
        <button class="btn btn-primary submit-btn" type="submit" @click="sentence_submit"
                data-loading-text="处理中...">切
        </button>
        <el-cascader
                :options="models"
                v-model="selectedOptions">
        </el-cascader>
        <button class="btn btn-primary copy">复制结果</button>
    </div>
    <div class="results">
        <div class="result" v-for="result in results">
            <div class="token col-xs-1" v-for="token in result">{{token}}</div>
        </div>
    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.bootcss.com/clipboard.js/2.0.4/clipboard.js"></script>
<script type="text/javascript" async>
</script>
<script type="text/javascript">
    $(document).ready(function () {
        let hasSubmit = false;
        var clipboard = new ClipboardJS('.copy', {
            text: function (trigger) {
                texts = [];
                for (var result in app.results) {
                    texts.push(app.results[result].join(" "))
                }
                return texts.join("\n")
            }
        });
        clipboard.on('success', function (e) {
            e.clearSelection();
        });

        let app = new Vue({
            el: '.main-container',
            data: {
                input_text: "私营企业主成为社会主义事业的建设者",
                results: [],
                models: [],
                selectedOptions: []
            },
            beforeCreate() {
                $.get("/models", function (data) {
                    app.models = data.models;
                });
            },
            methods: {
                sentence_submit: function () {
                    if (hasSubmit === false) {
                        hasSubmit = true;
                        let $btn = $(".submit-btn").button('loading');
                        setTimeout(function () {
                            $btn.button('reset');
                            hasSubmit = false;
                        }, 10000);
                        $.post("/v0/segment",
                            {
                                "input": app.input_text,
                                "solution": app.selectedOptions[app.selectedOptions.length - 1]
                            }, function (data) {
                                hasSubmit = false;
                                if (data.state === "success") {
                                    app.results = data.results;
                                    $btn.button('reset');
                                } else {
                                    alert("提交失败");
                                }
                            });
                    }
                },
            }
        });
    })
</script>
</body>
</html>